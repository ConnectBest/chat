erDiagram
  USERS ||--o{ CHANNEL_MEMBERS : has
  USERS ||--o{ MESSAGES : writes
  USERS ||--o{ REACTIONS : reacts
  CHANNELS ||--o{ MESSAGES : contains
  CHANNELS ||--o{ CHANNEL_MEMBERS : has
  MESSAGES ||--o{ THREADS : has
  MESSAGES ||--o{ MESSAGE_FILES : attaches
  FILES ||--o{ MESSAGE_FILES : linked

  USERS {
    uuid id PK
    text display_name
    text email
    text avatar_url
    boolean email_verified
    datetime created_at
  }

  CHANNELS {
    uuid id PK
    text name
    text topic
    boolean is_private
    uuid created_by FK
    datetime created_at
    datetime archived_at
  }

  CHANNEL_MEMBERS {
    uuid user_id FK
    uuid channel_id FK
    datetime joined_at
  }

  MESSAGES {
    uuid id PK
    uuid channel_id FK
    uuid author_id FK
    text text
    uuid parent_id
    datetime created_at
    datetime edited_at
  }

  THREADS {
    uuid parent_id FK
    uuid reply_id FK
  }

  FILES {
    uuid id PK
    text filename
    text mime_type
    int size_bytes
    text storage_url
    text status
  }

  MESSAGE_FILES {
    uuid message_id FK
    uuid file_id FK
  }

  REACTIONS {
    uuid message_id FK
    uuid user_id FK
    text emoji
  }
